{
  "kind": "build_request",
  "title": "Refine Message Analysis critical-trigger scoring thresholds (frontend-only)",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Update the Message Analysis text-scoring logic so that critical trigger phrase detection overrides normal incremental scoring and enforces minimum risk_score thresholds based on the number of detected critical triggers: 1 trigger => risk_score must start at (or be raised to) at least 85; 2 triggers => risk_score must be at least 92; 3 or more triggers => risk_score must be 100 (maximum). This refinement must apply only to message text analysis and must not affect phone/email/crypto analysis flows.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-latest"
        ],
        "quotes": [
          "Apply scoring refinement patch to Message Analysis only.\nEnhance critical keyword impact as follows:\nIf message contains any high-severity trigger phrase from the defined critical list, base risk_score must start at 85%.\nIf multiple critical triggers are detected:\n2 triggers → minimum 92%\n3 or more triggers → 100% (maximum)\nCritical phrases must override normal incremental scoring.\nThis applies ONLY to message text analysis."
        ]
      },
      "acceptanceCriteria": [
        "When analyzing a message containing 1 critical trigger phrase, the returned riskScore is >= 85 regardless of the underlying heuristic score.",
        "When analyzing a message containing exactly 2 critical trigger phrases, the returned riskScore is >= 92 regardless of the underlying heuristic score.",
        "When analyzing a message containing 3+ critical trigger phrases, the returned riskScore is exactly 100.",
        "The override applies only to message text analysis (e.g., the function exported as analyzeMessage in frontend utilities) and does not change scoring for phone, email, or crypto analysis.",
        "No data is persisted as part of this scoring change (no backend calls or storage of message content beyond in-memory processing for the current analysis)."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Integrate the user-provided critical words/phrases list into the existing critical risk dictionary used by Message Analysis (frontend), ensuring matching is case-insensitive and accent-insensitive. The integrated list must include all of the following exact triggers: dinheiro, transparência, ola pai, olá mãe, investimento, grátis, amigo, amiga, o seu filho, a sua filha, criptomoedas, dados, bancários, morada, liquidez; Urgente, Urgentíssimo, Ação necessária, Resposta imediata, Responda agora, Act immediately, Último aviso, Final warning; Sua conta será bloqueada hoje, Seu acesso será cancelado, Atividade suspeita, Suspicious activity, Tentativa de acesso indevido; Detectámos atividade suspeita no seu IP, na sua conta, Sua conta está em risco, será encerrada, foi suspensa; Não conseguimos processar o seu pagamento, Falha no pagamento, Payment failed, Fatura em atraso, Invoice em aberto, Cobrança pendente; Atualize seus dados, Confirme o cadastro, Verificação necessária, Precisamos da sua informação, We need your information, Verify now; Envie o código de 6 dígitos, Reenvie o código que recebeu por engano, Clique no link para confirmar/instalar/verificar; Informe os dados do seu cartão, Dados bancários, CVV, Senha de acesso; Você ganhou!, Prémio, Sorteio, Giveaway, Presente exclusivo, Bónus especial, Cashback garantido, Reembolso imediato; Poucas horas de trabalho alto retorno financeiro, Oferta imperdível, Uma oportunidade única na vida; Mudei de número salva este novo, Estou com problema no banco cartão podes fazer um pagamento por mim; Estou no estrangeiro e tive um acidente preciso de ajuda urgente, Faz uma transferência para este IBAN Pix MBWay para mim.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-critical-list"
        ],
        "quotes": [
          "Todas as palavras e frases listadas abaixo devem elevar o risco da mensagem para 85–100%.\nPalavras críticas e gatilhos\n...\nConfiguração de risco\nCada ocorrência destas palavras ou frases aumenta automaticamente o score para 85–100%.\nDeve ser cumulativo: múltiplos gatilhos numa mesma mensagem elevam o risco para o máximo 100%."
        ]
      },
      "acceptanceCriteria": [
        "All listed critical triggers are included in the frontend Message Analysis critical trigger detection list (no omissions).",
        "Matching detects triggers regardless of letter casing and diacritics (e.g., 'ola pai' matches 'Olá Pai').",
        "Trigger counting used for thresholding is based on detected trigger phrases in the message text and drives the 85/92/100 minimum thresholds.",
        "This integration is confined to message text analysis utilities and does not modify layout, routing, or other feature modules."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Ensure the Search (Phone) public number override logic remains untouched and continues to execute before any heuristics in the phone search flow; this message-analysis patch must not modify any Search (Phone) module files or behavior.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-latest"
        ],
        "quotes": [
          "Do NOT modify Search (Phone) module.\nPublic number override logic must remain untouched and execute before any heuristics."
        ]
      },
      "acceptanceCriteria": [
        "No changes are made to Search (Phone) module behavior or code paths as part of this patch.",
        "Phone lookups that previously used a public-number override continue to bypass heuristics and remain unaffected by message-scoring changes.",
        "Message analysis scoring changes do not alter any phone/email/crypto lookup results."
      ]
    }
  ],
  "constraints": [
    "Frontend-only patch (no backend changes; no backend restructuring).",
    "Do not modify layout.",
    "Do not modify the Search (Phone) module.",
    "No persistence of message contents or personal data; only in-memory processing for scoring.",
    "User-facing text in any new/changed strings must be in English."
  ],
  "nonGoals": [
    "Rebuilding or redesigning the application UI.",
    "Adding new pages, routes, or navigation items.",
    "Changing authentication/Internet Identity behavior.",
    "Introducing databases or any external integrations."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}